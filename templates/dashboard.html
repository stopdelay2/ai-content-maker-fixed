<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Content Maker - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100">
    <div x-data="dashboard()" x-init="loadDashboard()" class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <h1 class="text-2xl font-bold text-gray-900">ðŸ¤– AI Content Maker</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button @click="showCreateProject = true" 
                                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                            + New Project
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8">
                    <a href="#" @click.prevent="currentView = 'dashboard'" 
                       :class="currentView === 'dashboard' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                       class="border-b-2 py-4 px-1 text-sm font-medium">
                        Dashboard
                    </a>
                    <a href="#" @click.prevent="currentView = 'projects'" 
                       :class="currentView === 'projects' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                       class="border-b-2 py-4 px-1 text-sm font-medium">
                        Projects
                    </a>
                    <a href="#" @click.prevent="currentView = 'keywords'" 
                       :class="currentView === 'keywords' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                       class="border-b-2 py-4 px-1 text-sm font-medium">
                        Keywords
                    </a>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <!-- Loading -->
            <div x-show="loading" class="flex justify-center items-center py-12">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            </div>

            <!-- Dashboard View -->
            <div x-show="!loading && currentView === 'dashboard'">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                        <span class="text-white text-sm font-bold">P</span>
                                    </div>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">
                                            Active Projects
                                        </dt>
                                        <dd class="text-lg font-medium text-gray-900" x-text="stats.projects?.active || 0">
                                        </dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center">
                                        <span class="text-white text-sm font-bold">K</span>
                                    </div>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">
                                            Pending Keywords
                                        </dt>
                                        <dd class="text-lg font-medium text-gray-900" x-text="stats.keywords?.pending || 0">
                                        </dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                        <span class="text-white text-sm font-bold">A</span>
                                    </div>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">
                                            Total Articles
                                        </dt>
                                        <dd class="text-lg font-medium text-gray-900" x-text="stats.articles?.total || 0">
                                        </dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center">
                                        <span class="text-white text-sm font-bold">%</span>
                                    </div>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">
                                            Success Rate
                                        </dt>
                                        <dd class="text-lg font-medium text-gray-900" 
                                            x-text="Math.round((stats.keywords?.completed || 0) / Math.max(stats.keywords?.total || 1, 1) * 100) + '%'">
                                        </dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Recent Articles</h3>
                            <div class="flow-root">
                                <ul class="-mb-8">
                                    <template x-for="(article, index) in recentActivity.articles" :key="article.id">
                                        <li>
                                            <div class="relative pb-8" x-show="index < recentActivity.articles.length - 1">
                                                <span class="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200"></span>
                                            </div>
                                            <div class="relative flex space-x-3">
                                                <div class="flex h-8 w-8 items-center justify-center rounded-full bg-green-500">
                                                    <span class="text-white text-xs font-bold">A</span>
                                                </div>
                                                <div class="min-w-0 flex-1">
                                                    <div>
                                                        <p class="text-sm font-medium text-gray-900" x-text="article.title || 'Untitled'"></p>
                                                        <p class="text-sm text-gray-500" x-text="article.keyword"></p>
                                                        <p class="text-xs text-gray-400" x-text="new Date(article.created_at).toLocaleString()"></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                    </template>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Recent Keywords</h3>
                            <div class="space-y-3">
                                <template x-for="keyword in recentActivity.keywords" :key="keyword.id">
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div>
                                            <p class="text-sm font-medium text-gray-900" x-text="keyword.keyword"></p>
                                            <p class="text-xs text-gray-500" x-text="new Date(keyword.created_at).toLocaleDateString()"></p>
                                        </div>
                                        <div>
                                            <span :class="{
                                                'bg-yellow-100 text-yellow-800': keyword.status === 'pending',
                                                'bg-blue-100 text-blue-800': keyword.status === 'processing',
                                                'bg-green-100 text-green-800': keyword.status === 'completed',
                                                'bg-red-100 text-red-800': keyword.status === 'failed'
                                            }" 
                                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                                            x-text="keyword.status">
                                            </span>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Projects View -->
            <div x-show="!loading && currentView === 'projects'">
                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">Projects</h2>
                    <button @click="showCreateProject = true" 
                            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                        + Add Project
                    </button>
                </div>

                <!-- Projects Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <template x-for="project in projects" :key="project.id">
                        <div class="bg-white overflow-hidden shadow rounded-lg">
                            <div class="px-4 py-5 sm:p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-medium text-gray-900" x-text="project.name"></h3>
                                    <span :class="{
                                        'bg-green-100 text-green-800': project.status === 'active',
                                        'bg-yellow-100 text-yellow-800': project.status === 'paused',
                                        'bg-red-100 text-red-800': project.status === 'inactive'
                                    }" 
                                    class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                                    x-text="project.status">
                                    </span>
                                </div>
                                
                                <div class="text-sm text-gray-600 mb-4">
                                    <p x-text="project.website_url"></p>
                                    <p>Daily limit: <span x-text="project.daily_keywords_limit"></span> keywords</p>
                                </div>

                                <div class="grid grid-cols-2 gap-4 text-center">
                                    <div>
                                        <p class="text-2xl font-bold text-blue-600" x-text="project.stats?.total_keywords || 0"></p>
                                        <p class="text-xs text-gray-500">Keywords</p>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-green-600" x-text="project.stats?.total_articles || 0"></p>
                                        <p class="text-xs text-gray-500">Articles</p>
                                    </div>
                                </div>

                                <div class="mt-4 flex space-x-2">
                                    <button @click="viewProject(project.id)" 
                                            class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-md text-sm">
                                        View
                                    </button>
                                    <button @click="addKeywords(project.id)" 
                                            class="flex-1 bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-2 rounded-md text-sm">
                                        Add Keywords
                                    </button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </main>

        <!-- Create Project Modal -->
        <div x-show="showCreateProject" x-cloak 
             class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
            <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Create New Project</h3>
                    <form @submit.prevent="createProject()">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Project Name *</label>
                            <input x-model="newProject.name" type="text" required 
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Website URL *</label>
                            <input x-model="newProject.website_url" type="url" required 
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">WordPress Username</label>
                            <input x-model="newProject.wordpress_user" type="text" 
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">WordPress Password</label>
                            <input x-model="newProject.wordpress_password" type="password" 
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Daily Keywords Limit</label>
                            <input x-model="newProject.daily_keywords_limit" type="number" min="1" max="50" value="5" 
                                   class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="flex justify-end space-x-3">
                            <button type="button" @click="showCreateProject = false; resetNewProject()" 
                                    class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                                Cancel
                            </button>
                            <button type="submit" :disabled="creating"
                                    class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md disabled:opacity-50">
                                <span x-show="!creating">Create</span>
                                <span x-show="creating">Creating...</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        function dashboard() {
            return {
                loading: true,
                currentView: 'dashboard',
                projects: [],
                stats: {},
                recentActivity: { articles: [], keywords: [] },
                showCreateProject: false,
                creating: false,
                newProject: {
                    name: '',
                    website_url: '',
                    wordpress_user: '',
                    wordpress_password: '',
                    daily_keywords_limit: 5
                },

                async loadDashboard() {
                    this.loading = true;
                    try {
                        const [dashboardResponse, projectsResponse] = await Promise.all([
                            fetch('/api/dashboard'),
                            fetch('/api/projects')
                        ]);
                        
                        const dashboardData = await dashboardResponse.json();
                        const projectsData = await projectsResponse.json();
                        
                        if (dashboardData.success) {
                            this.stats = dashboardData.stats;
                            this.recentActivity = dashboardData.recent_activity;
                        }
                        
                        if (projectsData.success) {
                            this.projects = projectsData.projects;
                        }
                    } catch (error) {
                        console.error('Error loading dashboard:', error);
                    } finally {
                        this.loading = false;
                    }
                },

                async createProject() {
                    this.creating = true;
                    try {
                        const response = await fetch('/api/projects', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(this.newProject)
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.projects.push(data.project);
                            this.showCreateProject = false;
                            this.resetNewProject();
                            alert('Project created successfully!');
                        } else {
                            alert('Error: ' + data.error);
                        }
                    } catch (error) {
                        console.error('Error creating project:', error);
                        alert('Error creating project');
                    } finally {
                        this.creating = false;
                    }
                },

                resetNewProject() {
                    this.newProject = {
                        name: '',
                        website_url: '',
                        wordpress_user: '',
                        wordpress_password: '',
                        daily_keywords_limit: 5
                    };
                },

                viewProject(projectId) {
                    alert(`View project ${projectId} - Feature coming soon!`);
                },

                addKeywords(projectId) {
                    const keywords = prompt('Enter keywords separated by commas:');
                    if (keywords) {
                        const keywordList = keywords.split(',').map(k => k.trim()).filter(k => k);
                        this.submitKeywords(projectId, keywordList);
                    }
                },

                async submitKeywords(projectId, keywords) {
                    try {
                        const response = await fetch(`/api/projects/${projectId}/keywords`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ keywords })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            alert(data.message);
                            await this.loadDashboard(); // Refresh data
                        } else {
                            alert('Error: ' + data.error);
                        }
                    } catch (error) {
                        console.error('Error adding keywords:', error);
                        alert('Error adding keywords');
                    }
                }
            }
        }
    </script>

    <style>
        [x-cloak] { display: none !important; }
    </style>
</body>
</html>